<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rarity Calculator</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarpanch:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="centered-rectangle">
        <h1>Sol's RNG Rarity Calculator</h1>
        <p>Welcome to the most updated (i guess, dont hate me) Sol's RNG rarity calculator!</p>
        <p>I'm Jack, and I decided to contribute to this project after I saw the previous</p>
        <p>made by madder10 and wanted to help the community by doing a new one.</p>
    </div>

    <br></br>

    <form id="rarity-form">
        <label for="aura">Choose the aura:</label>
        <select id="aura" name="aura">
            <option value="" disabled style="color: grey;">-- Normal Auras</option>
            <option value="99999" class="exotic">Exotic</option>
            <option value="100400" class="diaboli-void">Diaboli: Void</option>
            <option value="120000" class="undead-devil">Undead: Devil</option>
            <option value="120001" class="comet">Comet</option>
            <option value="125000" class="jade">Jade</option>
            <option value="180000" class="aether">Aether</option>
            <option value="200000" class="bounded">Bounded</option>
            <option value="350000" class="celestial">Celestial</option>
            <option value="850000" class="kyawthuite">Kyawthuite</option>
            <option value="1000000" class="arcane">Arcane</option>
            <option value="1024000" class="magnetic-reverse-polarity">Magnetic: Reverse Polarity</option>
            <option value="1280000" class="rage-brawler">Rage: Brawler</option>
            <option value="1111000" class="undefined">Undefined</option>
            <option value="1336000" class="astral">Astral</option>
            <option value="2000000" class="gravitational">Gravitational</option>
            <option value="2000001" class="bounded-unbound">Bounded: Unbound</option>
            <option value="2500000" class="virtual">Virtual</option>
            <option value="3200000" class="savior">Savior</option>
            <option value="4000000" class="acquatic-flame">Aquatic: Flame</option>
            <option value="4000001" class="poseidon">Poseidon</option>
            <option value="4500000" class="zeus">Zeus</option>
            <option value="5000000" class="solar-solstice">Solar: Solstice</option>
            <option value="5000001" class="galaxy">Galaxy</option>
            <option value="5000002" class="lunar-fullmoon">Lunar: Full Moon</option>
            <option value="6000000" class="twilight">Twilight</option>
            <option value="6500000" class="origin">Origin</option>
            <option value="6666666" class="hades">Hades</option>
            <option value="7000000" class="celestial-divine">« CELESTIAL ✰ DIVINE »</option>
            <option value="7500000" class="hyper-volt">Hyper-Volt</option>
            <option value="9000000" class="nihility">[ Nihility ]</option>
            <option value="10000000" class="starscourge">Starscourge</option>
            <option value="12000000" class="sailor">Sailor</option>
            <option value="12210110" class="glitch">Glitch</option>
            <option value="13500000" class="stormal-hurricane">Stormal: Hurricane</option>
            <option value="14000000" class="sirius">Sirius</option>
            <option value="15000000" class="arcane-legacy">Arcane: Legacy</option>
            <option value="20000000" class="chromatic">Chromatic</option>
            <option value="24000000" class="aviator">★ Aviator ★</option>
            <option value="30000000" class="arcane-dark">Arcane: Dark</option>
            <option value="35000000" class="ethereal">Ethereal</option>
            <option value="45000000" class="overseer">Overseer</option>
            <option value="49999500" class="exotic-apex">Exotic · APEX</option>
            <option value="50000000" class="matrix">Matrix</option>
            <option value="60000000" class="twilight-iridescent-memory">Twilight: Iridescent Memory</option>
            <option value="80000000" class="sailor-flying-dutchman">Sailor: Flying Dutchman</option>
            <option value="99999999" class="chromatic-genesis">CHROMATIC: GENESIS</option>
            <option value="100000000" class="starscourge-radiant">STARSCOURGE: RADIANT</option>
            <option value="1200000000" class="luminosity">[ Luminosity ]</option>
            <option value="" disabled style="color: grey;">-- Current Event Auras</option>
            <option value="1000" class="⭐">⭐</option>
            <option value="10000" class="⭐⭐">⭐⭐</option>
            <option value="100000" class="⭐⭐⭐">⭐⭐⭐</option>
            <option value="12000000" class="wonderland">Wonderland</option>
            <option value="45000000" class="santa-frost">SANTA - FROST</option>
            <option value="72000000" class="winter-fantasy">< Winter fantasy ></option>
            <option value="90000000" class="express">Express</option>
            <option value="120000000" class="abomitable">{❄️ABOMITABLE❄️}</option>
            <option value="510000000" class="atlas-yuletide">A T L A S: YULETIDE</option>
        </select>

        <div style="height: 20px;"></div>
        <label for="right-gear">Right Gear:</label>
        <select id="right-gear" name="right-gear">
            <option value="0">None</option>
            <option value="0.25">Luck Glove (+25%)</option>
            <option value="0.5">Solar Device (+50%)</option>
            <option value="0.5">Eclipse Device (+50%)</option>
            <option value="0.5">Tide Gauntlet (+50%)</option>
            <option value="1">Exo Gauntlet (+100%)</option>
            <option value="1.15">Windstorm Device (+115%)</option>
            <option value="1.5">Subzero Device (+150%)</option>
            <option value="2.5">Galactic Device (+250%)</option>
            <option value="2.9">Volcanic Device (+290%)</option>
            <option value="3">Snow Rider (+300%)</option>
            <option value="3.4">Exoflex Device (+340%)</option>
            <option value="3.95">Hologrammer (+395%)</option>
            <option value="4.55">Ragnaröker (+455%)</option>
            <option value="7">Starshaper (+700%)</option>
            <option value="8">Pump punch (+800%)</option>
        </select>

        <div style="height: 20px;"></div>

        <label for="left-gear">Left Gear:</label>
        <select id="left-gear" name="left-gear">
            <option value="" disabled style="color: grey;">-- Bonus Roll</option>
            <option value="1.35">Flesh Device (x1.35)</option>
            <option value="3">Blessed Tide Gauntlet (x3)</option>
            <option value="4">X-Mas Champion (x4)</option>
            <option value="5">Dark Shader (x5)</option>
            <option value="5">Present Giver (x5)</option>
            <option value="6">Gravitational Device (x6)</option>
            <option value="" disabled style="color: grey;">-- Luck</option>
            <option value="jackpot">Jackpot Gauntlet (+77%)</option>
            <option value="pole">Pole Light Core Device (+500%)</option>
        </select>

        <div style="height: 20px;"></div>

        <label>Potions:</label>
        <div class="cb_potions">
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="potions_none" name="potions" value="0" onclick="potions_validateSelection()">
                    None
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="luckyPotion" name="potions" value="1" onclick="potions_validateSelection()">
                    Lucky Potion (+100%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="fortunePotionI" name="potions" value="1.5" onclick="potions_validateSelection()">
                    Fortune Potion I (+150%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="fortunePotionII" name="potions" value="2" onclick="potions_validateSelection()">
                    Fortune Potion II (+200%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="fortunePotionIII" name="potions" value="2.5" onclick="potions_validateSelection()">
                    Fortune Potion III (+250%)
                </label>
            </div>
        </div>

        <div style="height: -25px;"></div>

        <script>
        let potions_value = 0;
        
        function potions_validateSelection() {
            potions_value = 0;
            const checkboxes = document.querySelectorAll('input[name="potions"]:checked');
            const noneSelected = document.getElementById("potions_none").checked;
            const fortuneSelections = document.querySelectorAll('input[name="potions"]:checked[value="1.5"], input[name="potions"]:checked[value="2"], input[name="potions"]:checked[value="2.5"]');
            
            if (noneSelected) {
                document.querySelectorAll('input[name="potions"]:not(#potions_none)').forEach((checkbox) => {
                    checkbox.disabled = true;
                    checkbox.checked = false;
                });
            } else {
                document.querySelectorAll('input[name="potions"]:not(#potions_none)').forEach((checkbox) => {
                    checkbox.disabled = false;
                });
            }
        
            if (fortuneSelections.length > 1) {
                alert("You cannot select more than one type of Fortune Potion.");
                fortuneSelections[fortuneSelections.length - 1].checked = false;
                return;
            }
        
            checkboxes.forEach((checkbox) => {
                potions_value += parseFloat(checkbox.value);
            });
        
            if (checkboxes.length > 2) {
                alert("You can select a maximum of 2 potions.");
                checkboxes[checkboxes[checkboxes.length - 1]].checked = false;
            }
        }
        </script>        

        <div style="height: 20px;"></div>
                    
        <label for="final-luck">Final-Luck Potions:</label>
        <select id="final-luck" name="final-luck">
            <option value="0">None</option>
            <option value="20000">Heavenly Potion I (+20.000)</option>
            <option value="200000">Heavenly Potion II (+200.000)</option>
            <option value="500000">Oblivion Potion (+500.000)</option>
            <option value="700000">PumpKing's Blood (+700.000)</option>
        </select>

        <div style="height: 20px;"></div>

        <label for="other-effects">Other Effects:</label>
        <div class="cb_othereffects">
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="noEffect" name="effects" value="0" onclick="effects_validateSelection()">
                    No Effect
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="clover" name="effects" value="0.4" onclick="effects_validateSelection()">
                    Clover (+40%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="basicBlessing" name="effects" value="0.3" onclick="effects_validateSelection()">
                    Basic Blessing (+30%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="tipBlessing" name="effects" value="1.2" onclick="effects_validateSelection()">
                    Tip Blessing (+120%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="skilled" name="exclusiveEffects" value="0.1" onclick="effects_validateSelection()">
                    Skilled! (+10%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="expert" name="exclusiveEffects" value="0.2" onclick="effects_validateSelection()">
                    Expert! (+20%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="master" name="exclusiveEffects" value="0.3" onclick="effects_validateSelection()">
                    Master! (+30%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="grandmaster" name="exclusiveEffects" value="0.4" onclick="effects_validateSelection()">
                    Grandmaster! (+40%)
                </label>
            </div>
        </div>

        <div style="height: 0px;"></div>
        
        <script>
        let other_effects_value = 0;
        
        function effects_validateSelection() {
            other_effects_value = 0;
            const noEffectSelected = document.getElementById("noEffect").checked;
            const exclusiveEffects = document.querySelectorAll('input[name="exclusiveEffects"]:checked');
            const allEffects = document.querySelectorAll('input[name="effects"]:checked');
        
            if (noEffectSelected) {
                document.querySelectorAll('input[name="effects"]:not(#noEffect)').forEach((checkbox) => {
                    checkbox.disabled = true;
                    checkbox.checked = false;
                });
                document.querySelectorAll('input[name="exclusiveEffects"]').forEach((checkbox) => {
                    checkbox.disabled = true;
                    checkbox.checked = false;
                });
            } else {
                document.querySelectorAll('input[name="effects"]:not(#noEffect)').forEach((checkbox) => {
                    checkbox.disabled = false;
                });
                document.querySelectorAll('input[name="exclusiveEffects"]').forEach((checkbox) => {
                    checkbox.disabled = false;
                });
            }
        
            if (exclusiveEffects.length > 1) {
                alert("You can select only one of the exclusive effects (Skilled, Expert, Master, Grandmaster).");
                exclusiveEffects[exclusiveEffects.length - 1].checked = false;
            }
        
            if (noEffectSelected && allEffects.length > 1) {
                allEffects.forEach((checkbox) => {
                    if (checkbox !== document.getElementById("noEffect")) {
                        checkbox.checked = false;
                    }
                });
            }

            allEffects.forEach((checkbox) => {
                other_effects_value += parseFloat(checkbox.value);
            });
            exclusiveEffects.forEach((checkbox) => {
                other_effects_value += parseFloat(checkbox.value);
            });
        }
        </script>

        <div style="height: 20px;"></div>
                      
        <label for="resonance">Resonance of Elements (enter a number between 0 and 39):</label>
        <input type="number" id="resonance" name="resonance" min="0" max="39" step="1" value="0" oninput="res_validateInput()">

        <div style="height: 20px;"></div>
        
        <script>
        function res_validateInput() {
            const input = document.getElementById("resonance");
            let value = parseInt(input.value);
        
            if (isNaN(value) || value < 0) {
            value = 0;
            } else if (value > 39) {
            value = 39;
            }
            input.value = value;
        }
        </script>

        <label for="friend-count">No. of friends in the server (max 5):</label>
        <input type="number" id="friend-count" name="friend-count" min="0" max="5" value="0" oninput="friend_validateInput()">

        <div style="height: 20px;"></div>

        <script>
        function friend_validateInput() {
            const input = document.getElementById("friend-count");
            let value = parseInt(input.value);
        
            if (isNaN(value) || value < 0) {
            value = 0;
            } else if (value > 5) {
            value = 5;
            }
            input.value = value;
        }
        </script>

        <label for="vip">VIP gamepass/es:</label>
        <select id="vip" name="vip">
            <option value="1">None</option>
            <option value="1.2">VIP or VIP+ (x1.2)</option>
            <option value="1.35">VIP and VIP+ (x1.35)</option>
        </select>


        <button type="submit">Calculate!</button>
        <button type="button" onclick="openChangelog()">Changelog</button>
    </form>

    <div class="footer">
        <h6>Version 2.0 || Suggestions or bugs? -> my discord: <a href="http://discordapp.com/users/946093484568358922" target="_blank" style="color: white; font-weight: bold;">@itz_jaack</a></h6>
    </div>
    
    <script>
        function openChangelog() {
            const width = Math.min(window.innerWidth * 0.8, 800);
            const height = Math.min(window.innerHeight * 0.8, 600);
            const left = (screen.width - width) / 2;
            const top = (screen.height - height) / 2;
            window.open("changelog.html", "Changelog", `width=${width},height=${height},left=${left},top=${top}`);
        }

        document.getElementById("rarity-form").addEventListener("submit", function(event) {
            event.preventDefault();
    
            potions_validateSelection();
            effects_validateSelection();
    
            const aura = parseInt(document.getElementById("aura").value);
            let right_left_Gear = parseFloat(document.getElementById("right-gear").value);
            let bonusRoll = parseFloat(document.getElementById("left-gear").value);
            const leftGearValue = document.getElementById("left-gear").value;
            const poleLightCoreDevice = leftGearValue === "pole" ? 5 : 0;
            const leftGear = leftGearValue === "jackpot" ? 0.77 : 0;
            if (poleLightCoreDevice) {
                right_left_Gear += 5;
                bonusRoll = 2;
            }
            if (leftGear) {
                right_left_Gear += 0.77;
                bonusRoll = 2;
            }
            const potionss = potions_value;
            const finalLuck = parseInt(document.getElementById("final-luck").value);
            const other_effects = other_effects_value;
            const resonance_of_elements = parseFloat(document.getElementById("resonance").value) / 100;
            const friendCount = parseInt(document.getElementById("friend-count").value);
            const vip = parseFloat(document.getElementById("vip").value);
    
            const friendBonus = 0.05 * friendCount;
            const playerLuck = (((1 + right_left_Gear + friendBonus + potionss + other_effects + resonance_of_elements) * bonusRoll) + finalLuck) * vip;
            const percent = 100 * (playerLuck / aura);
            const prob = Math.round(1 / (percent / 100));
    
            const formattedProb = prob.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    
            console.log("Values used for playerLuck calculation:", {
                aura,
                right_left_Gear,
                bonusRoll,
                poleLightCoreDevice,
                potionss,
                finalLuck,
                other_effects,
                resonance_of_elements,
                friendCount,
                vip,
                friendBonus,
                playerLuck
            });
    
            console.log(`
                -------------
                Aura: ${aura}
                _-_-_-_-_-_-_
                Right Gear + Left Gear: ${right_left_Gear}
                Bonus Roll: ${bonusRoll}
                Potions: ${potionss}
                Final Luck: ${finalLuck}
                Other Effects: ${other_effects}
                Resonance of Elements: ${resonance_of_elements}
                Friend Count: ${friendCount}
                VIP: ${vip}
                Friend Bonus: ${friendBonus}
                -_-_-_-_-_-_-
                Player Luck (without bonus roll): ${playerLuck / bonusRoll}
                Player Luck (with bonus roll): ${playerLuck}
                -------------
            `);
    
            if (isNaN(percent) || isNaN(prob)) {
                alert(`Rarity %: ${percent.toFixed(10)}% \nRarity: 1 in ${aura.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")}`);
            } else {
                alert(`Rarity %: ${percent.toFixed(10)}% \nRarity: 1 in ${formattedProb}`);
            }
        });
    </script>    
</body>
</html>
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rarity Calculator</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarpanch:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="centered-rectangle">
        <h1>Sol's RNG Rarity Calculator</h1>
        <p>Welcome to the most updated (i guess, dont hate me) Sol's RNG rarity calculator!</p>
        <p>I'm Jack, and I decided to contribute to this project after I saw the previous</p>
        <p>made by madder10 and wanted to help the community by doing a new one.</p>
    </div>

    <br></br>

    <form id="rarity-form">
        <label for="aura">Choose the aura:</label>
        <select id="aura" name="aura">
            <option value="" disabled style="color: grey;">-- Normal Auras</option>
            <option value="50000" class="solar">Solar</option>
            <option value="50000" class="lunar">Lunar</option>
            <option value="50000" class="starlight">STARLIGHT</option>
            <option value="50000" class="star_rider">Star Rider</option>
            <option value="69000" class="flushed_lobotomy">Flushed: Lobotomy</option>
            <option value="70000" class="hazard_rays">HAZARD: RAYS</option>
            <option value="70000" class="nautilus">Nautilus</option>
            <option value="73500" class="permafrost">Permafrost</option>
            <option value="90000" class="stormal">Stormal</option>
            <option value="99999" class="exotic">Exotic</option>
            <option value="100400" class="diaboli_void">Diaboli: Void</option>
            <option value="120000" class="undead_devil">Undead: Devil</option>
            <option value="120000" class="comet">Comet</option>
            <option value="125000" class="jade">Jade</option>
            <option value="180000" class="aether">Aether</option>
            <option value="200000" class="bounded">Bounded</option>
            <option value="350000" class="celestial">Celestial</option>
            <option value="850000" class="kyawthuite">Kyawthuite</option>
            <option value="1000000" class="arcane">Arcane</option>
            <option value="1024000" class="magnetic_reverse_polarity">Magnetic: Reverse Polarity</option>
            <option value="1280000" class="rage_brawler">Rage: Brawler</option>
            <option value="1111000" class="undefined">Undefined</option>
            <option value="1336000" class="astral">Astral</option>
            <option value="2000000" class="gravitational">Gravitational</option>
            <option value="2000000" class="bounded_unbound">Bounded: Unbound</option>
            <option value="2500000" class="virtual">Virtual</option>
            <option value="3200000" class="savior">Savior</option>
            <option value="4000000" class="acquatic_flame">Aquatic: Flame</option>
            <option value="4000000" class="poseidon">Poseidon</option>
            <option value="4500000" class="zeus">Zeus</option>
            <option value="5000000" class="solar_solstice">Solar: Solstice</option>
            <option value="5000000" class="galaxy">Galaxy</option>
            <option value="5000000" class="lunar_fullmoon">Lunar: Full Moon</option>
            <option value="6000000" class="twilight">Twilight</option>
            <option value="6500000" class="origin">Origin</option>
            <option value="6666666" class="hades">Hades</option>
            <option value="7000000" class="celestial_divine">« CELESTIAL ✰ DIVINE »</option>
            <option value="7500000" class="hyper_volt">Hyper-Volt</option>
            <option value="9000000" class="nihility">[ Nihility ]</option>
            <option value="10000000" class="starscourge">Starscourge</option>
            <option value="12000000" class="sailor">Sailor</option>
            <option value="12210110" class="glitch">Glitch</option>
            <option value="13500000" class="stormal_hurricane">Stormal: Hurricane</option>
            <option value="14000000" class="sirius">Sirius</option>
            <option value="15000000" class="arcane_legacy">Arcane: Legacy</option>
            <option value="20000000" class="chromatic">Chromatic</option>
            <option value="24000000" class="aviator">★ Aviator ★</option>
            <option value="30000000" class="arcane_dark">Arcane: Dark</option>
            <option value="35000000" class="ethereal">Ethereal</option>
            <option value="45000000" class="overseer">Overseer</option>
            <option value="49999500" class="exotic_apex">Exotic · APEX</option>
            <option value="50000000" class="matrix">Matrix</option>
            <option value="60000000" class="twilight_iridescent_memory">Twilight: Iridescent Memory</option>
            <option value="80000000" class="sailor_flying_dutchman">Sailor: Flying Dutchman</option>
            <option value="99999999" class="chromatic_genesis">CHROMATIC: GENESIS</option>
            <option value="100000000" class="starscourge_radiant">STARSCOURGE: RADIANT</option>
            <option value="150000000" class="overture">Overture</option>
            <option value="175000000" class="symphony">Symphony</option>
            <option value="200000000" class="impeached">IMPEACHED</option>
            <option value="220000000" class="oppression">[ OPPRESSION ]</option>
            <option value="250000000" class="archangel">ARCHANGEL</option>
            <option value="300000000" class="overture_history">OVERTURE I HISTORY</option>
            <option value="300000000" class="bloodlust">B L O O D L U S T</option>
            <option value="360000000" class="atlas">ATLAS</option>
            <option value="400000000" class="abyssal_hunter">ABYSSAL HUNTER</option>
            <option value="430000000" class="gargantua">GARGANTUA</option>
            <option value="444000000" class="apostolos">APOSTOLOS</option>
            <option value="500000000" class="ruins">《 Ruins 》</option>
            <option value="503000000" class="matrix_overdrive">{♢ MATRIX /◆ OVERDRIVE ♢}</option>
            <option value="750000000" class="sovereign">SOVEREIGN</option>
            <option value="825000000" class="aegis">﴾AEGIS﴿</option>
            <option value="1200000000" class="luminosity">[ Luminosity ]</option>
            <option value="" disabled style="color: grey;">-- Current Event Auras</option>
            <option value="1000" class="⭐">⭐</option>
            <option value="10000" class="⭐⭐">⭐⭐</option>
            <option value="100000" class="⭐⭐⭐">⭐⭐⭐</option>
            <option value="12000000" class="wonderland">Wonderland</option>
            <option value="45000000" class="santa_frost">SANTA - FROST</option>
            <option value="72000000" class="winter_fantasy">< Winter fantasy ></option>
            <option value="90000000" class="express">Express</option>
            <option value="120000000" class="abomitable">{❄️ABOMITABLE❄️}</option>
            <option value="510000000" class="atlas_yuletide">A T L A S: YULETIDE</option>
        </select>

        <div style="height: 20px;"></div>

        <label for="right-gear">Right Gear:</label>
        <select id="right-gear" name="right-gear">
            <option value="0">None (+0%)</option>
            <option value="0.25">Luck Glove (+25%)</option>
            <option value="0.5">Solar Device (+50%)</option>
            <option value="0.5">Eclipse Device (+50%)</option>
            <option value="0.5">Tide Gauntlet (+50%)</option>
            <option value="1">Exo Gauntlet (+100%)</option>
            <option value="1.15">Windstorm Device (+115%)</option>
            <option value="1.5">Subzero Device (+150%)</option>
            <option value="2.5">Galactic Device (+250%)</option>
            <option value="2.9">Volcanic Device (+290%)</option>
            <option value="3">Snow Rider (+300%)</option>
            <option value="3.4">Exoflex Device (+340%)</option>
            <option value="3.95">Hologrammer (+395%)</option>
            <option value="4.55">Ragnaröker (+455%)</option>
            <option value="7">Starshaper (+700%)</option>
            <option value="8">Pump punch (+800%)</option>
        </select>

        <div style="height: 20px;"></div>

        <label for="left-gear">Left Gear:</label>
        <select id="left-gear" name="left-gear">
            <option value="" disabled style="color: grey;">-- Bonus Roll</option>
            <option value="2">None (x2)</option>
            <option value="1.35">Flesh Device (x1.35)</option>
            <option value="3">Blessed Tide Gauntlet (x3)</option>
            <option value="4">X-Mas Champion (x4)</option>
            <option value="5">Dark Shader (x5)</option>
            <option value="5">Present Giver (x5)</option>
            <option value="6">Gravitational Device (x6)</option>
            <option value="" disabled style="color: grey;">-- Luck</option>
            <option value="jackpot">Jackpot Gauntlet (+77%)</option>
            <option value="pole">Pole Light Core Device (+500%)</option>
        </select>

        <div style="height: 20px;"></div>

        <label>Potions:</label>
        <div class="cb_potions">
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="luckyPotion" name="potions" value="1" onclick="potions_validateSelection()">
                    Lucky Potion (+100%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="fortunePotionI" name="fortune" value="1.5" onclick="potions_validateSelection()">
                    Fortune Potion I (+150%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="fortunePotionII" name="fortune" value="2" onclick="potions_validateSelection()">
                    Fortune Potion II (+200%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="fortunePotionIII" name="fortune" value="2.5" onclick="potions_validateSelection()">
                    Fortune Potion III (+250%)
                </label>
            </div>
            
            <div style="height: 15px;"></div>
            
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="santa_claus" name="potions" value="1.5" onclick="potions_validateSelection()">
                    Santa Claus Potion (+150%)
                </label>
            </div>
        </div>
        
        <script>        
        function potions_validateSelection() {
            let potions_value = 0;
            const fortunePotions = document.querySelectorAll('input[name="fortune"]:checked');
            const allPotions = document.querySelectorAll('input[name="potions"]:checked, input[name="fortune"]:checked');
        
            if (fortunePotions.length > 1) {
                alert("You can select only one of the Fortune Potions (Fortune Potion I, Fortune Potion II, Fortune Potion III).");
                fortunePotions[fortunePotions.length - 1].checked = false;
            }
        
            allPotions.forEach((checkbox) => {
                potions_value += parseFloat(checkbox.value);
            });
        
            return potions_value;
        }
        </script>     

        <div style="height: 20px;"></div>
                    
        <label for="final-luck">Final-Luck Potions:</label>
        <select id="final-luck" name="final-luck">
            <option value="" disabled style="color: grey;">-- Final-Luck Potions</option>
            <option value="0">None</option>
            <option value="20000">Heavenly Potion I (+20.000)</option>
            <option value="200000">Heavenly Potion II (+200.000)</option>
            <option value="500000">Oblivion Potion (+500.000)</option>
            <option value="" disabled style="color: grey;">-- Current Event Final-Luck Potions</option>
        </select>

        <div style="height: 15px;"></div>

        <div class="checkbox-group">
            <label>
                <input type="checkbox" id="total-luck" name="total-luck" value="2">
                ??? (x2 Total Luck)
            </label>
        </div>

        <div style="height: 20px;"></div>

        <label for="other-effects" id="other-effects">Other Effects:</label>
        <div class="cb_othereffects">
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="clover" name="effects" value="0.4" onclick="effects_validateSelection()">
                    Clover (+40%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="luckypenny" name="effects" value="0.77" onclick="effects_validateSelection()">
                    Lucky Penny (+77%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="basicBlessing" name="effects" value="0.3" onclick="effects_validateSelection()">
                    Basic Blessing (+30%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="tipBlessing" name="effects" value="1.2" onclick="effects_validateSelection()">
                    Tip Blessing (+120%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="pumpkin" name="effects" value="1.5" onclick="effects_validateSelection()">
                    Pumpkin (+150%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="skilled" name="exclusiveEffects" value="0.1" onclick="effects_validateSelection()">
                    Skilled! (+10%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="expert" name="exclusiveEffects" value="0.2" onclick="effects_validateSelection()">
                    Expert! (+20%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="master" name="exclusiveEffects" value="0.3" onclick="effects_validateSelection()">
                    Master! (+30%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="grandmaster" name="exclusiveEffects" value="0.4" onclick="effects_validateSelection()">
                    Grandmaster! (+40%)
                </label>
            </div>

            <div style="height: 15px;"></div>

            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="wb" name="wbs" value="0.5" onclick="effects_validateSelection()">
                    Winter Blessing (+50%)
                </label>
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="wb+" name="wbs" value="1" onclick="effects_validateSelection()">
                    Winter Blessing + (+100%)
                </label>
            </div>
        </div>

        <div style="height: 0px;"></div>

        <script>
        function effects_validateSelection() {
            let other_effects_value = 0;
            const exclusiveEffects = document.querySelectorAll('input[name="exclusiveEffects"]:checked');
            const wbs = document.querySelectorAll('input[name="wbs"]:checked');
            const allEffects = document.querySelectorAll('input[name="effects"]:checked, input[name="exclusiveEffects"]:checked, input[name="wbs"]:checked');

            if (exclusiveEffects.length > 1) {
                alert("You can select only one of the achievement boosts (Skilled, Expert, Master, Grandmaster).");
                exclusiveEffects[exclusiveEffects.length - 1].checked = false;
            }
            if (wbs.length > 1) {
                alert("You can select only one of the Winter Blessings (Winter Blessing, Winter Blessing +).");
                wbs[wbs.length - 1].checked = false;
            }

            allEffects.forEach((checkbox) => {
                other_effects_value += parseFloat(checkbox.value);
            });
            exclusiveEffects.forEach((checkbox) => {
                other_effects_value += parseFloat(checkbox.value);
            });

            return other_effects_value;
        }
        </script>

        <div style="height: 20px;"></div>
                      
        <label for="resonance">Resonance of Elements (enter a number between 0 and 39):</label>
        <input type="number" id="resonance" name="resonance" min="0" max="39" step="1" value="0" oninput="res_validateInput()">

        <div style="height: 20px;"></div>
        
        <script>
        function res_validateInput() {
            const input = document.getElementById("resonance");
            let value = parseInt(input.value);
        
            if (isNaN(value) || value < 0) {
            value = 0;
            } else if (value > 39) {
            value = 39;
            }
            input.value = value;
        }
        </script>

        <label for="friend-count">No. of friends in the server (max 5):</label>
        <input type="number" id="friend-count" name="friend-count" min="0" max="5" value="0" oninput="friend_validateInput()">

        <div style="height: 20px;"></div>

        <script>
        function friend_validateInput() {
            const input = document.getElementById("friend-count");
            let value = parseInt(input.value);
        
            if (isNaN(value) || value < 0) {
            value = 0;
            } else if (value > 5) {
            value = 5;
            }
            input.value = value;
        }
        </script>

        <label for="vip">VIP gamepass/es:</label>
        <select id="vip" name="vip">
            <option value="1">None</option>
            <option value="1.2">VIP or VIP+ (x1.2)</option>
            <option value="1.35">VIP and VIP+ (x1.35)</option>
        </select>

        <button type="submit">Calculate!</button>
        <button type="button" onclick="openChangelog()">Changelog</button>
    </form>

    <div class="footer">
        <h6>Version 2.3 || Suggestions or bugs? -> my discord: <a href="http://discordapp.com/users/946093484568358922" target="_blank" style="color: white; font-weight: bold;">@itz_jaack</a></h6>
    </div>
    
    <script>
        function openChangelog() {
            const width = Math.min(window.innerWidth * 0.8, 800);
            const height = Math.min(window.innerHeight * 0.8, 600);
            const left = (screen.width - width) / 2;
            const top = (screen.height - height) / 2;
            window.open("changelog.html", "Changelog", `width=${width},height=${height},left=${left},top=${top}`);
        }

        document.getElementById("rarity-form").addEventListener("submit", function(event) {
            event.preventDefault();
    
            const potions_value = potions_validateSelection();
            const other_effects_value = effects_validateSelection();
    
            const aura = parseInt(document.getElementById("aura").value);
            let right_left_Gear = parseFloat(document.getElementById("right-gear").value);
            let bonusRoll = parseFloat(document.getElementById("left-gear").value);
            const leftGearValue = document.getElementById("left-gear").value;
            const poleLightCoreDevice = leftGearValue === "pole" ? 5 : 0;
            const leftGear = leftGearValue === "jackpot" ? 0.77 : 0;
            if (poleLightCoreDevice) {
                right_left_Gear += 5;
                bonusRoll = 2;
            }
            if (leftGear) {
                right_left_Gear += 0.77;
                bonusRoll = 2;
            }
            const finalLuck = parseInt(document.getElementById("final-luck").value);
            const resonance_of_elements = parseFloat(document.getElementById("resonance").value) / 100;
            const friendCount = parseInt(document.getElementById("friend-count").value);
            const vip = parseFloat(document.getElementById("vip").value);
    
            const friendBonus = 0.05 * friendCount;
            let playerLuck = (((1 + right_left_Gear + friendBonus + potions_value + other_effects_value + resonance_of_elements) * bonusRoll) + finalLuck) * vip;
    
            if (document.getElementById("total-luck").checked) {
                playerLuck *= 2;
            }
    
            const percent = 100 * (playerLuck / aura);
            const prob = Math.round(1 / (percent / 100));
    
            const formattedProb = prob.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    
            console.log("Values used for playerLuck calculation:", {
                aura,
                right_left_Gear,
                bonusRoll,
                poleLightCoreDevice,
                potions_value,
                finalLuck,
                other_effects_value,
                resonance_of_elements,
                friendCount,
                vip,
                friendBonus,
                playerLuck
            });
    
            console.log(`
                -------------
                Aura: ${aura}
                _-_-_-_-_-_-_
                Right Gear + Left Gear: ${right_left_Gear}
                Bonus Roll: ${bonusRoll}
                Potions: ${potions_value}
                Final Luck: ${finalLuck}
                Other Effects: ${other_effects_value}
                Resonance of Elements: ${resonance_of_elements}
                Friend Count: ${friendCount}
                VIP: ${vip}
                Friend Bonus: ${friendBonus}
                -_-_-_-_-_-_-
                Player Luck (without bonus roll): ${playerLuck / bonusRoll}
                Player Luck (with bonus roll): ${playerLuck}
                -------------
            `);
    
            if (isNaN(percent) || isNaN(prob)) {
                alert(`Rarity %: ${percent.toFixed(10)}% \nRarity: 1 in ${aura.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")}`);
            } else {
                alert(`Rarity %: ${percent.toFixed(10)}% \nRarity: 1 in ${formattedProb}`);
            }
        });
    </script>    
</body>
</html>
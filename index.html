<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rarity Calculator</title>
    <style>
        body {
            overflow-x: auto;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Sol's RNG Rarity Calculator</h1>
    <p>Welcome to the most updated (i guess, dont hate me) Sol's RNG rarity calculator!</p>
    <p>I'm Jack, and I decided to contribute to this project after I saw the previous</p>
    <p>made by madder10 and wanted to help the community by doing a new one.</p>

    <br></br>

    <form id="rarity-form">
        <label for="aura">Choose the aura:</label>
        <select id="aura" name="aura">
            <option value="99999">Exotic</option>
            <option value="100400">Diaboli: Void</option>
            <option value="120000">Undead: Devil</option>
            <option value="120000">Comet</option>
            <option value="125000">Jade</option>
            <option value="180000">Aether</option>
            <option value="200000">Bounded</option>
            <option value="350000">Celestial</option>
            <option value="850000">Kyawthuite</option>
            <option value="1000000">Arcane</option>
            <option value="1024000">Magnetic: Reverse Polarity</option>
            <option value="1280000">Rage Brawler</option>
            <option value="1111000">Undefined</option>
            <option value="1336000">Astral</option>
            <option value="2000000">Gravitational</option>
            <option value="2000000">Bounded: Unbound</option>
            <option value="2500000">Virtual</option>
            <option value="3200000">Savior</option>1
            <option value="4000000">Aquatic: Flame</option>
            <option value="4000000">Poseidon</option>
            <option value="4500000">Zeus</option>
            <option value="5000000">Solar: Solstice</option>
            <option value="5000000">Galaxy</option>
            <option value="5000000">Lunar: Full Moon</option>
            <option value="6000000">Twilight</option>
            <option value="6500000">Origin</option>
            <option value="6666666">Hades</option>
            <option value="7000000">Celestial: Divine</option>
            <option value="7500000">Hyper-Volt</option>
            <option value="9000000">Nihility</option>
            <option value="10000000">Starscourge</option>
            <option value="12000000">Sailor</option>
            <option value="12210110">Glitch</option>
            <option value="13500000">Stormal: Hurricane</option>
            <option value="14000000">Sirius</option>
            <option value="15000000">Arcane: Legacy</option>
            <option value="20000000">Chromatic</option>
            <option value="24000000">Aviator</option>
            <option value="30000000">Arcane: Dark</option>
            <option value="35000000">Ethereal</option>
            <option value="45000000">Overseer</option>
            <option value="49999500">Exotic: Apex</option>
            <option value="50000000">Matrix</option>
            <option value="60000000">Twilight: Iridescent Memory</option>
            <option value="80000000">Sailor: Flying Dutchman</option>
            <option value="99999999">Chromatic: Genesis</option>
            <option value="100000000">Starscourge: Radiant</option>
            <option value="150000000">Overture</option>
            <option value="175000000">Symphony</option>
            <option value="200000000">Impeached</option>
            <option value="220000000">Oppression</option>
            <option value="250000000">Archangel</option>
            <option value="300000000">Overture: History</option>
            <option value="300000000">Bloodlust</option>
            <option value="360000000">Atlas</option>
            <option value="400000000">Abyssal Hunter</option>
            <option value="430000000">Gargantua</option>
            <option value="444000000">Apostolos</option>
            <option value="500000000">Ruins</option>
            <option value="503000000">Matrix: Overdrive</option>
            <option value="750000000">Sovereign</option>
            <option value="825000000">Aegis</option>
            <option value="1200000000">Luminosity</option>
        </select>

        <br><br>

        <label for="right-gear">Right Gear:</label>
        <select id="right-gear" name="right-gear">
            <option value="0">None</option>
            <option value="0.25">Luck Glove</option>
            <option value="0.5">Solar Device</option>
            <option value="0.5">Eclipse Device</option>\
            <option value="0.5">Tide Gauntlet</option>
            <option value="1">Exo Gauntlet</option>
            <option value="1.15">Windstorm Device</option>
            <option value="1.5">Subzero Device</option>
            <option value="2.5">Galactic Device</option>
            <option value="2.9">Volcanic Device</option>
            <option value="3.4">Exoflex Device</option>
            <option value="3.95">Hologrammer</option>
            <option value="4.55">Ragnaroeker</option>
            <option value="7">Starshaper</option>
            <option value="8">Pump punch</option>
        </select>

        <br><br>

        <label for="left-gear">Left Gear:</label>
        <select id="left-gear" name="left-gear" disabled>
            <option value="1.35">Flesh Device (x1.35)</option>
            <option value="3">Blessed Tide Gauntlet (x3)</option>
            <option value="5">Dark Shader (x5)</option>
            <option value="6">Gravitational Device (x6)</option>
        </select>
        <input type="checkbox" id="bonus-roll" name="bonus-roll" onclick="toggleBonusRoll()">
        <label for="bonus-roll">Bonus Roll Gears</label>
        <input type="checkbox" id="jackpot-gauntlet" name="jackpot-gauntlet" onclick="toggleJackpotGauntlet()">
        <label for="jackpot-gauntlet">Jackpot Gauntlet</label>

        <br><br>

        <label>Potions:</label><br>
        <input type="checkbox" id="potions_none" name="potions" value="0" onclick="potions_validateSelection()">
        <label for="potions_none">None</label><br>
        <input type="checkbox" id="luckyPotion" name="potions" value="1" onclick="potions_validateSelection()">
        <label for="luckyPotion">Lucky Potion</label><br>
        <input type="checkbox" id="fortunePotionI" name="potions" value="1.5" onclick="potions_validateSelection()">
        <label for="fortunePotionI">Fortune Potion I</label><br>      
        <input type="checkbox" id="fortunePotionII" name="potions" value="2" onclick="potions_validateSelection()">
        <label for="fortunePotionII">Fortune Potion II</label><br>
        <input type="checkbox" id="fortunePotionIII" name="potions" value="2.5" onclick="potions_validateSelection()">
        <label for="fortunePotionIII">Fortune Potion III</label><br>

        <script>
        let potions_value = 0;
        
        function potions_validateSelection() {
            potions_value = 0;
            const checkboxes = document.querySelectorAll('input[name="potions"]:checked');
            const noneSelected = document.getElementById("potions_none").checked;
            const fortuneSelections = document.querySelectorAll('input[name="potions"]:checked[value="1.5"], input[name="potions"]:checked[value="2"], input[name="potions"]:checked[value="2.5"]');
            
            if (noneSelected) {
                document.querySelectorAll('input[name="potions"]:not(#potions_none)').forEach((checkbox) => {
                    checkbox.disabled = true;
                    checkbox.checked = false;
                });
            } else {
                document.querySelectorAll('input[name="potions"]:not(#potions_none)').forEach((checkbox) => {
                    checkbox.disabled = false;
                });
            }
        
            if (fortuneSelections.length > 1) {
                alert("You cannot select more than one type of Fortune Potion.");
                fortuneSelections[fortuneSelections.length - 1].checked = false;
                return;
            }
        
            checkboxes.forEach((checkbox) => {
                potions_value += parseFloat(checkbox.value);
            });
        
            if (checkboxes.length > 2) {
                alert("You can select a maximum of 2 potions.");
                checkboxes[checkboxes.length - 1].checked = false;
            }
        }
        </script>        
                    
        <br>

        <label for="final-luck">Final-Luck Potions:</label>
        <select id="final-luck" name="final-luck">
            <option value="0">None</option>
            <option value="20000">Heavenly Potion I</option>
            <option value="200000">Heavenly Potion II</option>
            <option value="500000">Oblivion Potion</option>
            <option value="700000">PumpKing's Blood</option>
        </select>

        <br><br>

        <label for="other-effects">Other Effects:</label><br>
        <input type="checkbox" id="noEffect" name="effects" value="0" onclick="effects_validateSelection()">
        <label for="noEffect">No Effect</label><br>
        <input type="checkbox" id="clover" name="effects" value="0.4" onclick="effects_validateSelection()">
        <label for="clover">Clover</label><br>
        <input type="checkbox" id="basicBlessing" name="effects" value="1.2" onclick="effects_validateSelection()">
        <label for="basicBlessing">Basic Blessing</label><br>
        <input type="checkbox" id="tipBlessing" name="effects" value="0.3" onclick="effects_validateSelection()">
        <label for="tipBlessing">Tip Blessing</label><br>
        <input type="checkbox" id="skilled" name="exclusiveEffects" value="0.1" onclick="effects_validateSelection()">
        <label for="skilled">Skilled!</label><br>
        <input type="checkbox" id="expert" name="exclusiveEffects" value="0.2" onclick="effects_validateSelection()">
        <label for="expert">Expert!</label><br>
        <input type="checkbox" id="master" name="exclusiveEffects" value="0.3" onclick="effects_validateSelection()">
        <label for="master">Master!</label><br>
        <input type="checkbox" id="grandmaster" name="exclusiveEffects" value="0.4" onclick="effects_validateSelection()">
        <label for="grandmaster">Grandmaster!</label><br>
        
        <script>
        let other_effects_value = 0;
        
        function effects_validateSelection() {
            other_effects_value = 0;
            const noEffectSelected = document.getElementById("noEffect").checked;
            const exclusiveEffects = document.querySelectorAll('input[name="exclusiveEffects"]:checked');
            const allEffects = document.querySelectorAll('input[name="effects"]:checked');
        
            if (noEffectSelected) {
                document.querySelectorAll('input[name="effects"]:not(#noEffect)').forEach((checkbox) => {
                    checkbox.disabled = true;
                    checkbox.checked = false;
                });
                document.querySelectorAll('input[name="exclusiveEffects"]').forEach((checkbox) => {
                    checkbox.disabled = true;
                    checkbox.checked = false;
                });
            } else {
                document.querySelectorAll('input[name="effects"]:not(#noEffect)').forEach((checkbox) => {
                    checkbox.disabled = false;
                });
                document.querySelectorAll('input[name="exclusiveEffects"]').forEach((checkbox) => {
                    checkbox.disabled = false;
                });
            }
        
            if (exclusiveEffects.length > 1) {
                alert("You can select only one of the exclusive effects (Skilled, Expert, Master, Grandmaster).");
                exclusiveEffects[exclusiveEffects.length - 1].checked = false;
            }
        
            if (noEffectSelected && allEffects.length > 1) {
                allEffects.forEach((checkbox) => {
                    if (checkbox !== document.getElementById("noEffect")) {
                        checkbox.checked = false;
                    }
                });
            }

            allEffects.forEach((checkbox) => {
                other_effects_value += parseFloat(checkbox.value);
            });
            exclusiveEffects.forEach((checkbox) => {
                other_effects_value += parseFloat(checkbox.value);
            });
        }
        </script>
                      
        <br>

        <label for="resonance">Resonance of Elements (enter a number between 0 and 39):</label>
        <input type="number" id="resonance" name="resonance" min="0" max="39" step="1" value="0" oninput="validateInput()">
        
        <script>
        function validateInput() {
            const input = document.getElementById("resonance");
            let value = parseInt(input.value);
        
            if (value > 39) {
                value = 39;
                input.value = value;  
            }
            if (value < 0) {
                value = 0;
                input.value = value;
            }
        }
        </script>

        <br><br>

        <label for="friend-count">No. of friends in the server (max 5):</label>
        <input type="number" id="friend-count" name="friend-count" min="0" max="5" value="0">

        <br><br>

        <label for="vip">VIP gamepass/es:</label>
        <select id="vip" name="vip">
            <option value="1">None</option>
            <option value="1.2">VIP or VIP+</option>
            <option value="1.35">VIP and VIP+</option>
        </select>

        <br><br>

        <button type="submit">Calculate!</button>
        
        <br><br>
        <br><br>

        <button type="button" onclick="openChangelog()">Changelog</button>
    </form>
    
    <script>
        function toggleBonusRoll() {
            const leftGearSelect = document.getElementById("left-gear");
            const jackpotGauntlet = document.getElementById("jackpot-gauntlet");
            if (document.getElementById("bonus-roll").checked) {
                leftGearSelect.disabled = false;
                jackpotGauntlet.disabled = true;
                jackpotGauntlet.checked = false;
            } else {
                leftGearSelect.disabled = true;
                jackpotGauntlet.disabled = false;
            }
        }

        function toggleJackpotGauntlet() {
            const bonusRoll = document.getElementById("bonus-roll");
            const leftGearSelect = document.getElementById("left-gear");
            if (document.getElementById("jackpot-gauntlet").checked) {
                bonusRoll.disabled = true;
                bonusRoll.checked = false;
                leftGearSelect.disabled = true;
            } else {
                bonusRoll.disabled = false;
            }
        }

        function openChangelog() {
            window.open("changelog.html", "Changelog", "width=auto,height=auto");
        }

        document.getElementById("rarity-form").addEventListener("submit", function(event) {
            event.preventDefault();
    
            potions_validateSelection();
            effects_validateSelection();
    
            const aura = parseInt(document.getElementById("aura").value);
            const rightGear = parseFloat(document.getElementById("right-gear").value);
            const bonusRoll = document.getElementById("jackpot-gauntlet").checked ? 2 : (document.getElementById("bonus-roll").checked ? parseFloat(document.getElementById("left-gear").value) : 2);
            const leftGear = document.getElementById("jackpot-gauntlet").checked ? 0.77 : 0;
            const potionss = potions_value;
            const finalLuck = parseInt(document.getElementById("final-luck").value);
            const other_effects = other_effects_value;
            const resonance_of_elements = parseFloat(document.getElementById("resonance").value) / 100;
            const friendCount = parseInt(document.getElementById("friend-count").value);
            const vip = parseFloat(document.getElementById("vip").value);
    
            const friendBonus = 0.05 * friendCount;
            const playerLuck = (((1 + rightGear + friendBonus + potionss + other_effects + resonance_of_elements + leftGear) * bonusRoll) + finalLuck) * vip;
            const percent = 100 * (playerLuck / aura);
            const prob = Math.round(1 / (percent / 100));
    
            const formattedProb = prob.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    
            console.log("Values used for playerLuck calculation:", {
                aura,
                rightGear,
                bonusRoll,
                leftGear,
                potionss,
                finalLuck,
                other_effects,
                resonance_of_elements,
                friendCount,
                vip,
                friendBonus,
                playerLuck
            });
    
            if (isNaN(percent) || isNaN(prob)) {
                alert(`Rarity %: ${percent.toFixed(10)}% \nRarity: 1 in ${aura.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")}`);
            } else {
                alert(`Rarity %: ${percent.toFixed(10)}% \nRarity: 1 in ${formattedProb}`);
            }
        });
    </script>    

    <h6>Version 1.0-beta (Suggestions or bugs? -> my discord: @itz_jaack)</h6>
</body>
</html>
